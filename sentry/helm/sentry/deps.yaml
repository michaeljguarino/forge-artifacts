apiVersion: plural.sh/v1alpha1
kind: Dependencies
metadata:
  application: true
  description: Deploys sentry crafted for the target cloud
spec:
  breaking: true
  instructions:
    instructions: |-
      Due to the unresolved issue https://github.com/getsentry/self-hosted/issues/2758 you'll need 
      to manually drop an index in your postgres db.  The command to do that is (execute within psql):

      drop index sentry_groupedmessage_project_id_id_515aaa7e_uniq

      (perform on the sentry db with `\c sentry` first)
  dependencies:
  - type: helm
    name: bootstrap
    repo: bootstrap
    version: '>= 0.5.1'
  - type: helm
    name: ingress-nginx
    repo: ingress-nginx
    version: '>= 0.1.2'
  - type: helm
    name: postgres
    repo: postgres
    version: '>= 0.2.13'
  - type: helm
    name: cluster-operator
    repo: rabbitmq
    version: '>= 0.1.8'
  - type: helm
    name: clickhouse
    repo: clickhouse
    version: ">= 0.1.3"
  - type: helm
    name: redis
    repo: redis
    version: '>= 0.1.1'
  - type: helm
    name: kafka
    repo: kafka
    version: '>= 0.1.3'
  - type: terraform
    name: aws
    repo: sentry
    version: '>= 0.1.1'
    optional: true
  - type: terraform
    name: azure
    repo: sentry
    version: '>= 0.1.1'
    optional: true
  - type: terraform
    name: gcp
    repo: sentry
    version: '>= 0.1.1'
    optional: true