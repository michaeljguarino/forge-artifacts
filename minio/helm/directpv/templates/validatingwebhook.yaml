{{- if .Values.controller.validatingWebhook.enabled }}
apiVersion: admissionregistration.k8s.io/v1
kind: ValidatingWebhookConfiguration
metadata:
  annotations:
    rbac.authorization.kubernetes.io/autoupdate: "true"
  creationTimestamp: null
  finalizers:
  - direct-csi-min-io/delete-protection
  labels:
    {{- include "directpv.labels" . | nindent 4 }}
  name: drive.validation.controller
webhooks:
- admissionReviewVersions:
  - v1
  - v1beta1
  - v1beta2
  - v1beta3
  clientConfig:
    caBundle: |-
{{ .Files.Get "certs/ca.pem" | b64enc | indent 6 }}
    service:
      name: directcsi-validation-controller
      namespace: {{ .Release.Namespace }}
      path: /validatedrive
  name: drive.validation.controller
  rules:
  - apiGroups:
    - '*'
    apiVersions:
    - '*'
    operations:
    - UPDATE
    resources:
    - directcsidrives
  sideEffects: None
{{- end }}
