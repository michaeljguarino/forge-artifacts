{{- if and (eq .Values.provider "google") (eq .Values.type "managed") -}}
apiVersion: infrastructure.cluster.x-k8s.io/v1beta1
kind: GCPManagedCluster
metadata:
  name: {{ .Values.cluster.name }}
  annotations:
    helm.sh/resource-policy: keep
spec:
  project: {{ .Values.cluster.google.project }}
  region: {{ .Values.cluster.google.region }}
  {{ with .Values.cluster.google.additionalLabels }}
  additionalLabels:
  {{ . | toYaml | nindent 4 }}
  {{ end }}
  controlPlaneEndpoint:
    host: ""
    port: 0
  {{ with .Values.cluster.google.addonsConfig }}
  addonsConfig:
  {{ . | toYaml | nindent 4 }}
  {{ end }}
  network:
    {{ with .Values.cluster.google.network }}
    name: {{ .name }}
    autoCreateSubnetworks: {{ .autoCreateSubnetworks }}
    datapathProvider: {{ .datapathProvider }}
    {{ end }}
    subnets:
      {{ range .Values.cluster.google.subnets }}
      - name: {{ .name }}
        region: {{ $.Values.cluster.google.region }}
        cidrBlock: {{ .cidrBlock }}
        description: {{ .description }}
        {{ with .secondaryCidrBlocks }}
        secondaryCidrBlocks:
        {{ . | toYaml | nindent 10 }}
        {{ end }}
        privateGoogleAccess: {{ .privateGoogleAccess }}
        enableFlowLogs: {{ .enableFlowLogs }}
        purpose: {{ .purpose }}
      {{ end }}
{{- end }}
