apiVersion: bootstrap.plural.sh/v1alpha1
kind: Bootstrap
metadata:
  name: {{ .Values.operator.clusterName }}
spec:
  clusterName: {{ .Values.operator.clusterName }}
  kubernetesVersion: {{ .Values.kubernetesVersion }}
  skipClusterCreation: {{ .Values.operator.skipClusterCreation }}
  clusterNetwork:
    pods:
      cidrBlocks:
        - 192.168.0.0/16
  clusterAPI:
    version: {{ .Values.clusterAPIVersion }}
    components:
      operator:
        managerImage: registry.k8s.io/capi-operator/cluster-api-operator:v0.2.0
        kubeRBACProxyImage: gcr.io/kubebuilder/kube-rbac-proxy:v0.8.0
  cloudSpec:
  {{- if .Values.operator.cloud.aws.enabled }}
    aws:
      {{- range $k, $v := .Values.operator.cloud.aws }}
      {{- if ne $k "enabled" }}
      {{- if or (kindIs "string" $v) (kindIs "bool" $v) (kindIs "int" $v) (kindIs "float64" $v) }}
      {{ $k }}: {{ $v }}
      {{- else }}
      {{ $k }}: {{- toYaml $v | nindent 8 }}
      {{- end }}
      {{- end }}
      {{- end }}
  {{- else if .Values.operator.cloud.azure.enabled }}
    azure:
      {{- range $k, $v := .Values.operator.cloud.azure }}
      {{- if ne $k "enabled" }}
      {{- if or (kindIs "string" $v) (kindIs "bool" $v) (kindIs "int" $v) (kindIs "float64" $v) }}
      {{ $k }}: {{ $v }}
      {{- else }}
      {{ $k }}: {{- toYaml $v | nindent 8 }}
      {{- end }}
      {{- end }}
      {{- end }}
  {{- else if .Values.operator.cloud.gcp.enabled }}
    gcp:
      {{- range $k, $v := .Values.operator.cloud.gcp }}
      {{- if ne $k "enabled" }}
      {{- if or (kindIs "string" $v) (kindIs "bool" $v) (kindIs "int" $v) (kindIs "float64" $v) }}
      {{ $k }}: {{ $v }}
      {{- else }}
      {{ $k }}: {{- toYaml $v | nindent 8 }}
      {{- end }}
      {{- end }}
      {{- end }}
  {{- end }}
